# Description

Managing node and bower dependencies is [not a trivial problem](https://docs.google.com/a/amplify.com/document/d/1KGL1Q8jpR_ZvSDJYD0IEGFFeQ1B6xxnN3yPsdWftyDk/edit). In summary, the solution is to commit your `node_modules` and `bower_cmoponents` directories. This package installs a script (`dep`) that automates the tedious and error prone steps of this process.

Once installed, you can run `dep -h` or `dep <command> -h` for up to date usage instructions.

# New project

Use the [angular-template](https://gitorious.poc.currdc.net/prototyping/angular-template/source/develop).

# Existing project

### 1. Get the latest release version of this package

```
$ npm install --save-dev 'git+ssh://git@gitorious.poc.currdc.net:prototyping/pro-dep.git#master'
$ git add package.json
$ git commit -m "Install pro-dep node module."
```

### 2. Setup your `PATH` to include project local `node_modules/.bin` directory

```
$ cat ~/.bashrc
PATH=./node_modules/.bin:$PATH
```

### 3. Migrate the project to use managed dependencies

```
$ dep lock-project-dependencies
```

This will:

* Save your working copy.
* Make note of and clear dependencies listed in `package.json` and `bower.json` files.
* Remove relevant `.gitignore` entries.
* For each `package.json` dependency, run `dep npm-install`.
* For each `bower.json` dependency, run `dep bower-install`.
* Install the exact version and freeze it in the appropriate json file.
* Commit changes at each step.
* Restore your working copy.

# After cloning a manged project, locally or on the build server

Build platform dependent binaries.

```
$ npm rebuild
```

# Installing a new bower component

You can use the same schemes for specifying a component as vanila `bower install`.

Latest version:   `dep bower-install lodash`

Exact version:    `dep bower-install 'lodash#1.3.4'`

From a git url:   `dep bower-install 'https://github.com/jquery/jquery.git#2.1.0'`

By default, `dep` assumes components to be production dependencies (`--save`).  
You can specifiy a dev dependency by adding a `--save-dev` flag.

# Uninstalling a bower component

`dep bower-uninstall lodash`

# Installing a new node module

You can use the same schemes for specifying a package as with vanila `npm install`.

Latest version:  `dep npm-install lodash`

Exact version:   `dep npm-install lodash@1.3.4`

From a git url:  `dep npm-install 'git+ssh://git@github.com:lodash/lodash.git#2.2.0'`

By default, `dep` assumes packages to be dev dependencies (`--save-dev`).  
You can specify a production dependency by adding the `--save` flag.

# Uninstalling a node module

`dep npm-uninstall lodash`

# Updating dep itself

`dep` manages `dep`

```
dep npm install 'git+ssh://git@gitorious.poc.currdc.net:prototyping/pro-dep.git#<version>'
```

Replace `<version>` with the tag of the desired version, with `master` for the latest release version, or with `develop` for the latest development version.


# Contributing

Fork, create a `feature/<name>` or `fix/<name>` branch, and submit a merge request.

## Running tests

Make sure you have `py.test` installed (globally or in a `virtualenv`.)

```
$ pip install pytest
```

Run the tests

```
$ py.test
```

## Bumping the version and tagging the release

Move to your release branch, and: 

```
$ gulp bump
```

This will prompt you for the type of version that you want to bump (patch, minor, or major), update `package.json` accordingly, and `git tag` the relase.